<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="jquery.min.js"></script>
<script>
$(document).ready(function () {
	$("#login").click(function() {
		$.ajax({
			method: "POST",
			url:"/login",
			contentType: "application/json; charset=utf-8",
			dataType: "json" /* expecting data type */,
			data: JSON.stringify({
				username: $("#username").val(),
				password: $("#password").val()
			})
		}).done(function (msg) {
			$("#retjson").text(JSON.stringify(msg, null, 2));
			var token = msg.token || '';
			$("#token").val(token);
		});
	});

	function proceed_to_auth(beforeSendCallbk) {
		$.ajax({
			method: "GET",
			url:"/test_auth",
			beforeSend: beforeSendCallbk
		}).done(function (msg) {
			$("#retjson").text(JSON.stringify(msg, null, 2));
			if (msg.pass) {
				setTimeout(function () {
					window.location.replace('some/where');
				}, 2000);
			}
		});
	}

	$("#auth-cookie").click(function() {
		proceed_to_auth();
	});
	$("#auth-header").click(function() {
		document.cookie='tk-auth=' + '';
		proceed_to_auth(function (request) {
			var token = $("#token").val();
			request.setRequestHeader("tk-auth", token);
		});
	});
});
</script>
</head>
<body>
<h3>Login</h3>
<input  id="username" placeholder="user name"/>
<input  id="password" placeholder="password"/>
<button id="login">login</button>

<h3>Auth</h3>
<input  id="token" style="width: 100%" placeholder="token"/>
<button id="auth-cookie">use cookie token</button>
<button id="auth-header">use HTTP header token</button>

<h3>Return JSON</h3>
<span id="retjson" style="color:gray"></span></p>
</body>
</html>
